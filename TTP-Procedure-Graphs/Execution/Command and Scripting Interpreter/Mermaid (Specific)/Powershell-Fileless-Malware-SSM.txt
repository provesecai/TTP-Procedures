graph TD;
    A[Initial Foothold Gained]
    B[Prepare for SSM Exploitation]
    C[Deploy PowerShell Command via SSM]
    D[Execute Command in Target Environment]
    E[Execution Achieved]

    A -->|"Access gained via stolen AWS credentials Corporate Control: AWS IAM Console"| B
    A -->|"Attacker authenticates to AWS Management Console using stolen API keys Corporate Control: AWS Authentication"| B
    A -->|"Enumerate IAM permissions to identify SSM access Corporate Control: IAM Policies"| B
    A -->|"Monitor for unauthorized AWS login attempts Corporate Control: AWS CloudTrail"| B
    B -->|"Configure target EC2 instances for SSM communication Corporate Control: AWS EC2"| C
    B -->|"Prepare obfuscated PowerShell script to bypass AWS monitoring Corporate Control: Script Repository"| C
    B -->|"Store the script temporarily in an S3 bucket Corporate Control: AWS S3 Storage"| C
    B -->|"Detection possible by monitoring unusual S3 bucket activity Corporate Control: Cloud Monitoring Tools"| C
    C -->|"Execute SSM Run Command to invoke the PowerShell script Corporate Control: AWS Systems Manager"| D
    C -->|"Leverage SSM Agent installed on EC2 instances for execution Corporate Control: EC2 Instances"| D
    C -->|"Monitor execution logs for unusual activities Corporate Control: AWS CloudWatch Logs"| D
    D -->|"PowerShell script executes commands to disable security tools Corporate Control: Endpoint Protection"| E
    D -->|"Establish communication with an attacker-controlled server Corporate Control: C2 Network Infrastructure"| E
    D -->|"Validate execution success via attacker C2 server Corporate Control: External Monitoring"| E
    D -->|"Execution achieves full control over compromised instances Corporate Control: Target EC2 Instance"| E
