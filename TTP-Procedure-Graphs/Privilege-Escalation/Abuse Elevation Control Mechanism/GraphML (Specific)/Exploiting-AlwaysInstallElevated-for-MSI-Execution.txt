<graphml xmlns="http://graphml.graphdrawing.org/xmlns" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://graphml.graphdrawing.org/xmlns http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd">
<graph id="Exploiting-AlwaysInstallElevated-for-MSI-Execution" edgedefault="directed">
<!--  Nodes  -->
<node id="A">
<data key="label">Identify Misconfigured AlwaysInstallElevated Settings</data>
</node>
<node id="B">
<data key="label">Create Malicious MSI Package</data>
</node>
<node id="C">
<data key="label">Execute MSI with SYSTEM Privileges</data>
</node>
<node id="D">
<data key="label">Prevent Detection of MSI Exploitation</data>
</node>
<node id="E">
<data key="label">Persistence Achieved via AlwaysInstallElevated</data>
</node>
<!--  Edges with Conditions  -->
<edge source="A" target="B">
<data key="label">Check registry keys for AlwaysInstallElevated setting Corporate Control: Windows Group Policy Management</data>
</edge>
<edge source="A" target="B">
<data key="label">Determine if non-admin users can install MSI packages with elevated privileges Corporate Control: Windows Security Policies</data>
</edge>
<edge source="A" target="B">
<data key="label">Monitor for unauthorized changes to AlwaysInstallElevated settings Corporate Control: SIEM, Windows Event Logs</data>
</edge>
<edge source="B" target="C">
<data key="label">Create a malicious MSI package to execute arbitrary code Corporate Control: Windows Installer Security</data>
</edge>
<edge source="B" target="C">
<data key="label">Ensure MSI is configured to run under SYSTEM privileges Corporate Control: NTFS File Permissions</data>
</edge>
<edge source="B" target="C">
<data key="label">Leverage msiexec.exe to execute payload Corporate Control: Windows Executable Policy Enforcement</data>
</edge>
<edge source="B" target="C">
<data key="label">Monitor for unauthorized MSI installations Corporate Control: Endpoint Detection and Response (EDR)</data>
</edge>
<edge source="C" target="D">
<data key="label">Validate SYSTEM privileges by executing administrative tasks Corporate Control: Windows User Privilege Verification</data>
</edge>
<edge source="C" target="D">
<data key="label">Ensure persistence through registry modifications Corporate Control: Windows Startup Configuration</data>
</edge>
<edge source="C" target="D">
<data key="label">Modify MSI installation logs to prevent detection Corporate Control: Windows Logging Mechanisms</data>
</edge>
<edge source="C" target="D">
<data key="label">Monitor unauthorized elevation via MSI execution Corporate Control: SIEM, Windows Event Monitoring</data>
</edge>
<edge source="D" target="E">
<data key="label">Modify system logs to erase traces of MSI execution Corporate Control: Log Scrubbing Techniques</data>
</edge>
<edge source="D" target="E">
<data key="label">Deploy additional MSI persistence techniques Corporate Control: Alternate Installer Execution Methods</data>
</edge>
<edge source="D" target="E">
<data key="label">Ensure continued SYSTEM access via MSI-based execution Corporate Control: Windows Package Management</data>
</edge>
<edge source="D" target="E">
<data key="label">SOC continuously monitors for unauthorized MSI executions Corporate Control: Security Operations Center (SOC)</data>
</edge>
</graph>
</graphml>
